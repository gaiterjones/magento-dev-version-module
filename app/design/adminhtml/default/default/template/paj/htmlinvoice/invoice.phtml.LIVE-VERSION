<?php 

	$_order = $this->getOrder();
	
	$payment = $_order->getPayment();
	
	$groupId = $_order->getCustomerGroupId();

		
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>von Wellean EigenArt <?php echo ($groupId < 2 ) ? 'Nail Art Shop' : 'Professional' ?> Rechnung - <?php echo $_order->getIncrementId(); ?></title>
<link rel="stylesheet" type="text/css" href="includes/stylesheet.css">
<link rel="stylesheet" type="text/css" href="includes/watermark.css">
<style type="text/css">
BODY {
	font-family: Arial, Helvetica, sans-serif;
	margin: 0;
	padding: 0;
	font-size: 12px;
}
.wrapper {
	margin: 20px;
}
.dataTableHeadingRow {
	background: none;
}
.dataTableHeadingContent {
	font-size: 12px;
	color: #000;
	padding: 6px;
	border-bottom: 2px solid #999;
}
.dataTableRow {
	background: none;
}
.dataTableContent {
	padding: 2px 6px;
	border-bottom: 1px solid #eee;
}

.alt TD { background: #eee; }

#footer {
	text-align: center;
	margin: 60px 0 0 0;
	color: #666;
}
#notes {
	border: 1px solid #999;
	width: 530px;
	height: 80px;
	padding: 5px;
	margin: 0 0 0 20px;
}
#notes TEXTAREA {
	border: none;
	width: 470px;
	height: 60px;
	overflow: hidden;
	margin: 5px 0 0 0;
	border: 0;
}
a.addr_link {
	color: #000;
	text-decoration: none;
}
.option-menu {
	padding: 8px;
	background: #eee;
	font-size: 10px;
}
.totals .label {
	padding: 5px 20px 5px 0;
}
.totals .total td {
	font-size: 1.3em;
	border-top: 1px solid #ccc;
}
div.watermark {
	display:block;
	position:fixed;
	z-index:100;
	width:100%;
	height:100%;
}
 div.content > *:first-child, x:-moz-any-link {
margin-top:0;
}/* ff only */
 div.watermark, x:-moz-any-link {
z-index:auto;
}/* ff only */
 div.watermark, x:-moz-any-link, x:default {
z-index:100;
}/* ff3 only */
 @media all and (min-width: 0px) {
div.watermark {
width:8.5in;
}
} /* opera only */
div.watermark div {
	position:absolute;
	left:0;
	width:99%;
}
/* watermark position */
/* horizontal */
div.left {
	text-align:left;
}
div.center {
	text-align:center;
}
div.right {
	text-align:right;
}
 body:last-child:not(:root:root) div.right div {
left:-160px;
}/* safari only */
/* vertical */
div.top div {
	top:0;
}
div.middle div {
	top:50%;
	margin-top:-210px;
}
div.bottom div {
	bottom:2px;
}
.clearfix:after {
	content: ".";
	display: block;
	height: 0;
	clear: both;
	visibility: hidden;
}
.clearfix {
	display: inline-block;
}  /* for IE/Mac */


.button {
	-moz-box-shadow:inset 0px 1px 0px 0px #fce2c1;
	-webkit-box-shadow:inset 0px 1px 0px 0px #fce2c1;
	box-shadow:inset 0px 1px 0px 0px #fce2c1;
	background:-webkit-gradient( linear, left top, left bottom, color-stop(0.05, #ffc477), color-stop(1, #fb9e25) );
	background:-moz-linear-gradient( center top, #ffc477 5%, #fb9e25 100% );
	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#ffc477', endColorstr='#fb9e25');
	background-color:#ffc477;
	-moz-border-radius:6px;
	-webkit-border-radius:6px;
	border-radius:6px;
	border:1px solid #eeb44f;
	display:inline-block;
	color:#ffffff;
	font-family:arial;
	font-size:15px;
	font-weight:bold;
	padding:6px 24px;
	text-decoration:none;
	text-shadow:1px 1px 0px #cc9f52;
}.button:hover {
	background:-webkit-gradient( linear, left top, left bottom, color-stop(0.05, #fb9e25), color-stop(1, #ffc477) );
	background:-moz-linear-gradient( center top, #fb9e25 5%, #ffc477 100% );
	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#fb9e25', endColorstr='#ffc477');
	background-color:#fb9e25;
}.button:active {
	position:relative;
	top:1px;
}
</style>
<style media="print" type="text/css">
.wrapper {
	margin: 0;
}
.option-menu {
	display: none;
}
</style>
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
</head>
<body>
<div class="option-menu"> <strong>Options:</strong> &nbsp;
  <label>
  <input id="cbk_paid" type="checkbox" onchange="if(this.checked){document.getElementById('watermark_paid').style.display = 'block';}else{document.getElementById('watermark_paid').style.display = 'none';}"  />
  Watermark</label>
  <p>
	<a href="#" class="button" onclick="window.print(); return false;">Print</a> 
  </p>
</div>
<div id="watermark_paid" class="watermark middle center" style="display: none;">
  <div><img alt="Paid In Full" src="https://www.vw-e.de/media/upload/image/paid-in-full.png" /></div>
</div>
<div id="invoice" class="wrapper" >
  <!-- body_text //-->
  <h1 style="float: right;">Rechnung</h1>
  <div class="clearfix">
    
    <div style="float: left; width: 400px; font-size: 10px;" id="brand_logo"> <img src="https://www.vw-e.de/public/<?php echo ($groupId < 2 ) ? 'logo_email_b2c.gif' : 'logo_email_b2b.gif' ?>"><br />
    </div>
  </div>
  <table width="100%" border="0" cellspacing="0" cellpadding="2">
    <tr>
      <td valign="top"><p><strong>Rechnungsinformationen:</strong></p>
        <?php echo $_order->getBillingAddress()->format('html'); ?>
        <p><?php echo '<a href="mailto:' . $_order->getCustomerEmail() . '"><u>' . $_order->getCustomerEmail() . '</u></a>'; ?></p></td>
      <td valign="top"><p><strong>Versandinformationen:</strong></p>
        <?php echo $_order->getShippingAddress()->format('html'); ?> </td>
      <td valign="top"><p>Online Rechnung Nr.: <strong><?php echo $_order->getIncrementId(); ?></strong></p>
        <p>
		Datum:
		  <strong> <?php echo date("d.m.Y");  ?> </strong><br />
        Zahlungsart:
          <strong><?php echo $_order->getPayment()->getMethodInstance()->getTitle();  ?></strong><br />
        Lieferung per:
          <strong><?php echo $_order->getShippingDescription()  ?></strong><br />
        Lieferdatum:
          <strong><?php echo date("d.m.Y");  ?></strong><br />
        </p>		
		</td>
    </tr>
  </table>
  <table border="0" width="99%" cellspacing="0" cellpadding="0">
    <tr class="dataTableHeadingRow">
      <td class="dataTableHeadingContent">Menge</td>
      <td class="dataTableHeadingContent">Art.-Nr</td>
      <td class="dataTableHeadingContent" align="left">Artikel</td>
      <td class="dataTableHeadingContent" align="right"><?php echo ($groupId < 2 ) ? 'EUR inkl. MwSt.' : 'EUR' ?></td>
      <td class="dataTableHeadingContent" align="right"><?php echo ($groupId < 2 ) ? 'Zwischensumme inkl. MwSt.' : 'Zwischensumme' ?></td>
    </tr>
    <?php
	
	$_items = $_order->getAllItems();
	
	
	$x = 0; 
	
   	foreach($_items as $_item) {
		
		if ($_item->getParentItem()) continue; 
		
      echo '      <tr class="dataTableRow ' . ($x%2==0 ? "" : "alt") . '">' . "\n" .
           '        <td class="dataTableContent" valign="top" align="">' . number_format($_item->getQtyOrdered(), 0) . '</td>' . "\n" .
           '         <td class="dataTableContent" valign="top">' . $_item->getSku() . '</td>' . "\n" . 
		   '		 <td class="dataTableContent" valign="top">' . $_item->getName();

		if ($options = $_item->getProductOptions()) {
		
			$result = array();
		
            if (isset($options['options'])) {
                $result = array_merge($result, $options['options']);
            }
            if (isset($options['additional_options'])) {
                $result = array_merge($result, $options['additional_options']);
            }
            if (!empty($options['attributes_info'])) {
                $result = array_merge($options['attributes_info'], $result);
            }
			
			// loop and print
			foreach ($result as $_option) {
					echo "<br /><em>" . $_option["label"] . ":</em>&nbsp;&nbsp;" . $_option["value"];
			}
			
			
			
        }
	  $finalPrice=$_item->getPrice();
	  $rowTotal=$_item->getRowTotal();
	  
	  if ($groupId < 2)
	  {
	  // manually add 19% VAT to pricing
	  $finalPrice=round($_item->getPrice()+($_item->getPrice()*0.19),2);
	  $rowTotal=round($_item->getRowTotal()+($_item->getRowTotal()*0.19),2);
	  }
	  
	  
      echo '        </td>' . "\n" .
           '        <td class="dataTableContent" align="right" valign="top"><b>' . $_order->formatPriceTxt($finalPrice) .  '</b></td>' . "\n" .
           '        <td class="dataTableContent" align="right" valign="top"><b>' . $_order->formatPriceTxt($rowTotal) . '</b></td>' . "\n";
      echo '      </tr>' . "\n";
	  
	  $x++;
	  
    }
?>
    <tr>
      <td align="right" colspan="8"><table border="0" cellspacing="0" cellpadding="2" class="totals">
          <?php if ($_order->getShippingDescription()): ?>
		  <?php
		  
		  if ($groupId < 2) {
		  // add tax to shipping amount
		  $shippingInclTax = $_order->getShippingAmount() + $_order->getShippingTaxAmount();
		  $_order->setShippingAmount($shippingInclTax);
		  }
		  
		  
		  $paymentDescription=$_order->getPayment()->getMethodInstance()->getTitle();
		  if ($paymentDescription==="Nachnahme")
		  {
			$_order->setShippingDescription($_order->getShippingDescription() . ' + Nachnahme');
		  }
		  ?>		  
          <tr>
            <td align="right" class="label"><?php echo $_order->getShippingDescription() ?></td>
            <td align="right"><strong><?php echo $_order->formatPriceTxt($_order->getShippingAmount()) ?></strong></td>
          </tr>
          <?php endif; ?>
          
          <?php if ($_order->getDiscountAmount() != 0): ?>
          <tr>
            <td align="right" class="label">Rabatt : <?php echo $_order->getDiscountDescription() ?></td>
            <td align="right"><strong><?php echo $_order->formatPriceTxt($_order->getDiscountAmount()) ?></strong></td>
          </tr>
          <?php endif; ?>
          
          <?php if ($_order->getTaxAmount() > 0): ?>
          <tr>
            <td align="right" class="label"><?php echo ($groupId < 2 ) ? 'enthaltene Mehrwertsteuer 19%' : 'Mehrwertsteuer 19%' ?></td>
            <td align="right"><strong><?php echo $_order->formatPriceTxt($_order->getTaxAmount()) ?></strong></td>
          </tr>
          <?php endif; ?>
          <tr class="total">
            <td align="right" class="label"><strong>Gesamtsumme</strong></td>
            <td align="right"><strong><?php echo $_order->formatPriceTxt($_order->getGrandTotal()) ?></strong></td>
          </tr>
        </table></td>
    </tr>
  </table>
  <div>
  <?php echo $this->getLayout()->createBlock('cms/block')->setBlockId('widerrufsrecht-block')->toHtml() ?>  
  </div>
  <div id="footer">
    <h2>Vielen Dank f&uuml;r Ihre Bestellung.</h2>
  </div>
  <!-- body_text_eof //-->
</div>
</body>
</html>
